```html
{% extends 'base.html' %}
{% block title %}CRUD de Juegos{% endblock %}

{% block content %}
<style>
.page-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1em;
    padding: 1em;
    height: calc(100vh - 200px);
    overflow: hidden;
}

.buttons-container {
    height: 100%;
    overflow-y: auto;
}

.crud-buttons {
    position: sticky;
    top: 0;
}

.button-row {
    display: flex;
    flex-direction: column;
    gap: 0.8em;
}

.button-row .rpgui-button {
    width: 100%;
    padding: 0.5em !important;
    min-height: unset !important;
}

.forms-container {
    height: 100%;
    overflow-y: auto;
    padding-right: 1em;
}

.operation-form {
    margin-bottom: 1em;
    padding: 1em;
}

.form-group {
    margin-bottom: 0.8em;
    display: grid;
    grid-template-columns: 150px 1fr;
    align-items: center;
    gap: 0.5em;
}

.form-group label {
    font-size: 0.9em;
}

.form-group input {
    width: 100%;
    padding: 0.4em;
}

.form-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 0.8em;
    margin-top: 1em;
}

.form-buttons .rpgui-button {
    padding: 0.5em 1em !important;
    min-height: unset !important;
}

h2, h3 {
    text-align: center;
    margin-bottom: 0.8em;
    font-size: 1.1em;
}

.message {
    padding: 0.8em;
    margin-bottom: 1em;
    border-radius: 4px;
}

.success { background-color: rgba(0, 255, 0, 0.1); color: #00ff00; }
.error { background-color: rgba(255, 0, 0, 0.1); color: #ff0000; }

@media (max-width: 768px) {
    .page-layout {
        grid-template-columns: 1fr;
        height: auto;
        overflow: visible;
    }

    .forms-container {
        height: auto;
        overflow: visible;
    }

    .form-group {
        grid-template-columns: 1fr;
    }

    .form-buttons {
        flex-direction: column;
    }

    .form-buttons .rpgui-button {
        width: 100%;
    }
}
</style>

<div class="page-layout">
    <!-- Columna izquierda: Botones -->
    <div class="buttons-container">
        <div class="crud-buttons rpgui-container framed-golden">
            <h2>🎮 Opciones</h2>
            <div class="button-row">
                <button class="rpgui-button" onclick="showCreateForm()">
                    <span>➕ Crear</span>
                </button>
                <button class="rpgui-button" onclick="showDeleteForm()">
                    <span>🗑️ Eliminar</span>
                </button>
                <button class="rpgui-button" onclick="showUpdateForm()">
                    <span>✏️ Actualizar</span>
                </button>
                <button class="rpgui-button" onclick="showSearchById()">
                    <span>🔍 Buscar ID</span>
                </button>
                <button class="rpgui-button" onclick="showSearchByName()">
                    <span>🔎 Buscar Nombre</span>
                </button>
                <button class="rpgui-button" onclick="showImportForm()">
                    <span>📥 Importar</span>
                </button>
                <!-- Reemplaza el botón actual de listar con este -->
<button class="rpgui-button" onclick="showGamesList()">
    <span>📋 Listar</span>
</button>
            </div>
        </div>
    </div>

    <!-- Columna derecha: Formularios -->
    <div class="forms-container">
        {% if success_msg %}
        <div class="message success">{{ success_msg }}</div>
        {% endif %}
        {% if error_msg %}
        <div class="message error">{{ error_msg }}</div>
        {% endif %}

        <!-- Formularios aquí -->
        <!-- Ejemplo del formulario de creación (los demás seguirían el mismo patrón) -->
        <div id="createForm" class="operation-form rpgui-container framed-golden" style="display: none;">
            <h3>➕ Crear Nuevo Juego</h3>
            <form onsubmit="createGame(event)">
                <div class="form-group">
                    <label class="rpgui-label">🎲 Nombre:</label>
                    <input type="text" id="createGameName" class="rpgui-input" required>
                </div>
                <div class="form-group">
                    <label class="rpgui-label">📅 Fecha:</label>
                    <input type="text" 
                           id="createGameDate" 
                           class="rpgui-input" 
                           placeholder="AAAA-MM-DD" 
                           pattern="\d{4}-\d{2}-\d{2}"
                           title="Usa el formato AAAA-MM-DD (ejemplo: 2024-01-01)"
                           oninput="formatearFecha(this)"
                           onblur="validarFecha(this)"
                           required>
                    <span id="fechaError" style="color: #ff6b6b; display: none; font-size: 0.8em; margin-top: 0.3em;">
                        Por favor, ingresa una fecha válida en formato AAAA-MM-DD
                    </span>
                </div>
                <div class="form-group">
                    <label class="rpgui-label">⌛ Horas:</label>
                    <input type="number" id="createGameHours" class="rpgui-input" min="0" required>
                </div>
                <div class="form-group">
                    <label class="rpgui-label">👥 Espectadores:</label>
                    <input type="number" id="createGamePeakViewers" class="rpgui-input" min="0" required>
                </div>
                <div class="form-group">
                    <label class="rpgui-label">📺 Canales:</label>
                    <input type="number" id="createGamePeakChannels" class="rpgui-input" min="0" required>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="rpgui-button">💾 Guardar</button>
                </div>
            </form>
        </div>

        <!-- Formulario de Eliminación -->
        <div id="deleteForm" class="operation-form rpgui-container framed-golden" style="display: none;">
            <h3>🗑️ Eliminar Juego</h3>
            <form onsubmit="deleteGame(event)">
                <div class="form-group">
                    <label class="rpgui-label">🔢 ID del Juego:</label>
                    <input type="number" id="deleteGameId" class="rpgui-input" required min="1">
                </div>
                <div class="form-buttons">
                    <button type="submit" class="rpgui-button">
                        <span>🗑️ Eliminar</span>
                    </button>
                    <button type="button" class="rpgui-button" onclick="hideAllForms()">
                        <span>❌ Cancelar</span>
                    </button>
                </div>
            </form>
        </div>
<!-- Formulario de Búsqueda por ID -->
<div id="searchByIdForm" class="operation-form rpgui-container framed-golden" style="display: none;">
    <h3>🔍 Buscar Juego por ID</h3>
    <form onsubmit="buscarPorId(event)">
        <div class="form-group">
            <label class="rpgui-label">🎲 ID del Juego:</label>
            <input type="number"
                   id="buscarGameId"
                   class="rpgui-input"
                   min="1"
                   required>
        </div>
        <div class="form-buttons">
            <button type="submit" class="rpgui-button">
                <span>🔍 Buscar</span>
            </button>
            <button type="button" class="rpgui-button" onclick="hideAllForms()">
                <span>❌ Cancelar</span>
            </button>
        </div>
    </form>

    <!-- Contenedor para mostrar el resultado -->
    <div id="searchIdResult" style="display: none; margin-top: 20px;">
        <h3>📋 Resultado:</h3>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Fecha</th>
                        <th>Horas Vistas</th>
                        <th>Pico Espectadores</th>
                        <th>Pico Canales</th>
                    </tr>
                </thead>
                <tbody id="searchIdResultsBody">
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Formulario de Búsqueda por Nombre -->
<div id="searchByNameForm" class="operation-form rpgui-container framed-golden" style="display: none;">
    <style>
        #searchByNameForm {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .table-wrapper {
            max-height: 120px; /* Altura para 3 filas */
            overflow-y: auto;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .table-wrapper::-webkit-scrollbar {
            width: 12px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background-color: #8b7355;
            border-radius: 10px;
            border: 2px solid #2c2c2c;
        }

        .table-wrapper table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-wrapper thead {
            position: sticky;
            top: 0;
            background: #2c2c2c;
            z-index: 1;
        }

        .table-wrapper th,
        .table-wrapper td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid rgba(139, 115, 85, 0.3);
            height: 40px; /* Altura fija para cada fila */
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
    </style>

    <h3>🔎 Buscar Juego por Nombre</h3>
    <form onsubmit="buscarPorNombre(event)">
        <div class="form-group">
            <label class="rpgui-label">🎲 Nombre del Juego:</label>
            <input type="text"
                   id="buscarGameName"
                   class="rpgui-input"
                   required
                   minlength="1"
                   placeholder="Ingresa al menos un carácter">
        </div>
        <div class="form-buttons">
            <button type="submit" class="rpgui-button">
                <span>🔎 Buscar</span>
            </button>
            <button type="button" class="rpgui-button" onclick="hideAllForms()">
                <span>❌ Cancelar</span>
            </button>
        </div>
    </form>

    <!-- Contenedor para mostrar los resultados -->
    <div id="searchNameResult" style="display: none;">
        <h3>📋 Resultados:</h3>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Fecha</th>
                        <th>Horas Vistas</th>
                        <th>Pico Espectadores</th>
                        <th>Pico Canales</th>
                    </tr>
                </thead>
                <tbody id="searchNameResultsBody">
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
async function buscarPorNombre(event) {
    event.preventDefault();
    const nombre = document.getElementById("buscarGameName").value;

    try {
        const response = await fetch(`/api/games/search?game_name=${encodeURIComponent(nombre)}`);
        const tbody = document.getElementById("searchNameResultsBody");
        tbody.innerHTML = ''; // Limpiar resultados anteriores

        if (response.ok) {
            const games = await response.json();

            if (games.length > 0) {
                games.forEach(game => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${game.id}</td>
                        <td>${game.game}</td>
                        <td>${game.date}</td>
                        <td>${game.hours_watched.toLocaleString()}</td>
                        <td>${game.peak_viewers.toLocaleString()}</td>
                        <td>${game.peak_channels.toLocaleString()}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center;">
                            No se encontraron juegos con el nombre "${nombre}"
                        </td>
                    </tr>`;
            }
        } else {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center;">
                        Nombre no encontrado: "${nombre}"
                    </td>
                </tr>`;
        }

        document.getElementById("searchNameResult").style.display = "block";
    } catch (error) {
        console.error(error);
        const tbody = document.getElementById("searchNameResultsBody");
        tbody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">
                    Nombre no encontrado: "${nombre}"
                </td>
            </tr>`;
        document.getElementById("searchNameResult").style.display = "block";
    }
}
</script>     <!-- Los demás formularios seguirían el mismo patrón -->
        <!-- ... -->
<!-- Formulario de Actualización -->
<div id="updateForm" class="operation-form rpgui-container framed-golden" style="display: none;">
    <h3>✏️ Actualizar Juego</h3>
    <form onsubmit="updateGame(event)">
        <div class="form-group">
            <label class="rpgui-label">🔢 ID del Juego:</label>
            <input type="number" id="updateGameId" class="rpgui-input" required min="1">
        </div>
        <div class="form-group">
            <label class="rpgui-label">🎲 Nombre:</label>
            <input type="text" id="updateGameName" class="rpgui-input" required>
        </div>
<div class="form-group">
    <label class="rpgui-label">📅 Fecha:</label>
    <input type="text" id="updateGameDate" class="rpgui-input"
           placeholder="AAAA-MM-DD"
           pattern="\d{4}-\d{2}-\d{2}"
           title="Usa el formato AAAA-MM-DD (ejemplo: 2024-01-01)"
           oninput="formatearFecha(this)"
           onblur="validarFecha(this)"
           required>
    <span id="updateFechaError" style="color: #ff6b6b; display: none; font-size: 0.8em; margin-top: 0.3em;">
        Por favor, ingresa una fecha válida en formato AAAA-MM-DD
    </span>
</div>
        <div class="form-group">
            <label class="rpgui-label">⌛ Horas Vistas:</label>
            <input type="number" id="updateGameHours" class="rpgui-input" min="0" required>
        </div>
        <div class="form-group">
            <label class="rpgui-label">👥 Pico de Espectadores:</label>
            <input type="number" id="updateGamePeakViewers" class="rpgui-input" min="0" required>
        </div>
        <div class="form-group">
            <label class="rpgui-label">📺 Pico de Canales:</label>
            <input type="number" id="updateGamePeakChannels" class="rpgui-input" min="0" required>
        </div>
        <div class="form-buttons">
            <button type="submit" class="rpgui-button">
                <span>💾 Guardar</span>
            </button>
            <button type="button" class="rpgui-button" onclick="hideAllForms()">
                <span>❌ Cancelar</span>
            </button>
        </div>
    </form>
</div>
    </div>
</div>

<!-- El script se mantiene igual -->
<script>
async function confirmDelete(gameId) {
    if (confirm('¿Estás seguro de que deseas eliminar este juego?')) {
        try {
            const response = await fetch(`/api/games/${gameId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                location.reload();
            } else {
                const error = await response.json();
                alert('Error al eliminar el juego: ' + error.detail);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al eliminar el juego');
        }
    }
}

function refreshList() {
    location.reload();
}

function exportToCSV() {
    const table = document.querySelector('table');
    let csv = [];
    const rows = table.querySelectorAll('tr');

    for (let i = 0; i < rows.length; i++) {
        let row = [], cols = rows[i].querySelectorAll('td, th');

        for (let j = 0; j < cols.length - 1; j++) {
            row.push(cols[j].innerText);
        }

        csv.push(row.join(','));
    }

    const csvContent = 'data:text/csv;charset=utf-8,' + csv.join('\n');
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement('a');
    link.setAttribute('href', encodedUri);
    link.setAttribute('download', 'games_data.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

<style>
/* Añade estos estilos para los botones en la tabla */
.actions {
    display: flex;
    gap: 8px;
    justify-content: center;
}

.actions .rpgui-button {
    padding: 5px 10px !important;
    min-height: unset !important;
    font-size: 0.9em;
}
</style>
<script>
function showSearchByName() {
    hideAllForms();
    document.getElementById('searchByNameForm').style.display = 'block';
}

async function buscarPorNombre(event) {
    event.preventDefault();
    const nombre = document.getElementById("buscarGameName").value;

    try {
        const response = await fetch(`/api/games/search?game_name=${encodeURIComponent(nombre)}`);
        const tbody = document.getElementById("searchNameResultsBody");
        tbody.innerHTML = ''; // Limpiar resultados anteriores

        if (response.ok) {
            const games = await response.json();

            if (games.length > 0) {
                games.forEach(game => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${game.id}</td>
                        <td>${game.game}</td>
                        <td>${game.date}</td>
                        <td>${game.hours_watched.toLocaleString()}</td>
                        <td>${game.peak_viewers.toLocaleString()}</td>
                        <td>${game.peak_channels.toLocaleString()}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center;">
                            No se encontraron juegos con el nombre "${nombre}"
                        </td>
                    </tr>`;
            }
        } else {
            throw new Error('Error en la búsqueda');
        }

        document.getElementById("searchNameResult").style.display = "block";
    } catch (error) {
        console.error(error);
        alert("Hubo un error al realizar la búsqueda");
    }
}
</script>
<script>
// Función para dar formato a la fecha mientras se escribe
function formatearFecha(input) {
    // Eliminar cualquier carácter que no sea número
    let valor = input.value.replace(/\D/g, '');

    // Si tenemos 8 o más dígitos, formateamos como AAAA-MM-DD
    if (valor.length >= 8) {
        valor = valor.slice(0, 8); // Limitamos a 8 dígitos
        valor = valor.slice(0, 4) + '-' + valor.slice(4, 6) + '-' + valor.slice(6);
    }
    // Si tenemos 6 dígitos, añadimos el primer guion
    else if (valor.length >= 6) {
        valor = valor.slice(0, 4) + '-' + valor.slice(4, 6) + '-' + valor.slice(6);
    }
    // Si tenemos 4 dígitos, añadimos el primer guion
    else if (valor.length >= 4) {
        valor = valor.slice(0, 4) + '-' + valor.slice(4);
    }

    input.value = valor;
}

// Función para validar la fecha
function validarFecha(input) {
    const errorSpanId = input.id === 'updateGameDate' ? 'updateFechaError' : 'fechaError';
    const fechaError = document.getElementById(errorSpanId);
    const valor = input.value;
    const regex = /^(\d{4})-(\d{2})-(\d{2})$/;

    if (!regex.test(valor)) {
        fechaError.textContent = 'Formato inválido. Usa AAAA-MM-DD';
        fechaError.style.display = 'block';
        input.setCustomValidity('Formato inválido');
        return false;
    }

    const [, año, mes, dia] = valor.match(regex);
    const añoNum = parseInt(año);
    const mesNum = parseInt(mes);
    const diaNum = parseInt(dia);

    // Validar rango de fechas
    if (añoNum < 2000 || añoNum > 2025) {
        fechaError.textContent = 'El año debe estar entre 2000 y 2025';
        fechaError.style.display = 'block';
        input.setCustomValidity('Año fuera de rango');
        return false;
    }

    if (mesNum < 1 || mesNum > 12) {
        fechaError.textContent = 'El mes debe estar entre 01 y 12';
        fechaError.style.display = 'block';
        input.setCustomValidity('Mes inválido');
        return false;
    }

    // Validar días según el mes
    const diasEnMes = new Date(añoNum, mesNum, 0).getDate();
    if (diaNum < 1 || diaNum > diasEnMes) {
        fechaError.textContent = `El día debe estar entre 01 y ${diasEnMes} para el mes seleccionado`;
        fechaError.style.display = 'block';
        input.setCustomValidity('Día inválido');
        return false;
    }

    fechaError.style.display = 'none';
    input.setCustomValidity('');
    return true;
}

// Modificar la función updateGame para incluir la validación
async function updateGame(event) {
    event.preventDefault();
    const gameId = document.getElementById('updateGameId').value;
    const gameName = document.getElementById('updateGameName').value;
    const fechaInput = document.getElementById('updateGameDate');

    if (!validarFecha(fechaInput)) {
        return;
    }

    const gameData = {
        game: gameName,
        date: fechaInput.value,
        hours_watched: parseInt(document.getElementById('updateGameHours').value),
        peak_viewers: parseInt(document.getElementById('updateGamePeakViewers').value),
        peak_channels: parseInt(document.getElementById('updateGamePeakChannels').value)
    };

    try {
        const response = await fetch(`/api/games/${gameId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(gameData)
        });

        if (response.ok) {
            alert(`¡El juego "${gameName}" con ID ${gameId} ha sido actualizado correctamente!`);
            location.reload();
        } else {
            const error = await response.json();
            alert('Error al actualizar el juego: ' + error.detail);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al actualizar el juego');
    }
}

// Añadir validación antes de enviar el formulario
document.querySelector('form').addEventListener('submit', function(event) {
    const fechaInput = document.getElementById('createGameDate');
    if (!validarFecha(fechaInput)) {
        event.preventDefault();
    }
});

// Añade esta función
function showGamesList() {
    hideAllForms();  // Primero ocultamos todos los formularios
    listGames();     // Luego llamamos a listGames para mostrar la lista
}

// Modifica la función hideAllForms existente
function hideAllForms() {
    const forms = [
        'createForm',
        'deleteForm',
        'updateForm',
        'searchByIdForm',
        'searchByNameForm',
        'importForm',
        'listForm'  // Añade listForm aquí
    ];

    forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (form) {
            form.style.display = 'none';
            // Si es el listForm, también lo removemos del DOM
            if (formId === 'listForm') {
                form.remove();
            }
        }
    });
}

function showForm(formId) {
    hideAllForms();
    document.getElementById(formId).style.display = 'block';
}

function showCreateForm() {
    showForm('createForm');
}

function showSearchById() {
    showForm('searchByIdForm');
}

function showSearchByName() {
    showForm('searchByNameForm');
}

function showUpdateForm() {
    showForm('updateForm');
}

function showDeleteForm() {
    showForm('deleteForm');
}

function showImportForm() {
    showForm('importForm');
}

async function createGame(event) {
    event.preventDefault();
    const gameData = {
        game: document.getElementById('createGameName').value,
        date: document.getElementById('createGameDate').value,
        hours_watched: parseInt(document.getElementById('createGameHours').value),
        peak_viewers: parseInt(document.getElementById('createGamePeakViewers').value),
        peak_channels: parseInt(document.getElementById('createGamePeakChannels').value)
    };

    try {
        const response = await fetch('/api/games/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(gameData)
        });

        if (response.ok) {
            alert('¡Juego creado correctamente!');
            location.reload();
        } else {
            const error = await response.json();
            alert('Error al crear el juego: ' + error.detail);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al crear el juego');
    }
}

async function searchByName(event) {
    event.preventDefault();
    const name = document.getElementById('searchGameName').value;
    location.href = `/games?game_name=${encodeURIComponent(name)}`;
}

// Función para mostrar el formulario de actualización
function showUpdateForm() {
    hideAllForms();
    document.getElementById('updateForm').style.display = 'block';
}

async function deleteGame(event) {
    event.preventDefault();
    const gameId = document.getElementById('deleteGameId').value;

    if (confirm('¿Estás seguro de que deseas eliminar este juego?')) {
        try {
            const response = await fetch(`/api/games/${gameId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('¡Juego eliminado correctamente!');
                location.reload();
            } else {
                const error = await response.json();
                alert('Error al eliminar el juego: ' + error.detail);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al eliminar el juego');
        }
    }
}
async function buscarPorId(event) {
    event.preventDefault();
    const id = document.getElementById("buscarGameId").value;

    try {
        const response = await fetch(`/api/games/${id}`);
        const tbody = document.getElementById("searchIdResultsBody");
        tbody.innerHTML = ''; // Limpiar resultados anteriores

        if (response.ok) {
            const game = await response.json();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${game.id}</td>
                <td>${game.game}</td>
                <td>${game.date}</td>
                <td>${game.hours_watched.toLocaleString()}</td>
                <td>${game.peak_viewers.toLocaleString()}</td>
                <td>${game.peak_channels.toLocaleString()}</td>
            `;
            tbody.appendChild(row);
        } else {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center;">
                        No se encontró ningún juego con el ID ${id}
                    </td>
                </tr>`;
        }

        document.getElementById("searchIdResult").style.display = "block";
    } catch (error) {
        console.error(error);
        alert("Hubo un error al realizar la búsqueda");
    }
}

function showSearchById() {
    hideAllForms();
    // Mostrar el formulario
    document.getElementById('searchByIdForm').style.display = 'block';

    // Limpiar el campo de entrada
    document.getElementById('buscarGameId').value = '';

    // Limpiar los resultados previos
    const tbody = document.getElementById("searchIdResultsBody");
    if (tbody) {
        tbody.innerHTML = '';
    }

    // Ocultar la sección de resultados
    const searchResult = document.getElementById("searchIdResult");
    if (searchResult) {
        searchResult.style.display = 'none';
    }
}

function showSearchByName() {
    hideAllForms();

    // Mostrar el formulario
    document.getElementById('searchByNameForm').style.display = 'block';

    // Limpiar el campo de búsqueda
    document.getElementById('buscarGameName').value = '';

    // Ocultar y limpiar los resultados anteriores
    const searchResult = document.getElementById('searchNameResult');
    if (searchResult) {
        searchResult.style.display = 'none';
    }

    const tbody = document.getElementById('searchNameResultsBody');
    if (tbody) {
        tbody.innerHTML = '';
    }
}
async function importGames(event) {
    event.preventDefault();
    const formData = new FormData();
    const fileInput = document.getElementById('importFile');
    formData.append('file', fileInput.files[0]);

    try {
        const response = await fetch('/games/import', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            alert('Juegos importados correctamente');
            location.reload();
        } else {
            const error = await response.json();
            alert('Error al importar los juegos: ' + error.detail);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al importar los juegos');
    }
}
</script>

<script>
// Agregar esta función al script existente
async function listGames() {
    try {
        const response = await fetch('/api/games');
        if (response.ok) {
            const games = await response.json();
            // Ocultar todos los formularios
            hideAllForms();

            // Crear una tabla dinámica
            let tableHTML = `
                <div id="listForm" class="operation-form rpgui-container framed-golden">
                    <h3>📋 Lista de Juegos</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Fecha</th>
                                    <th>Horas Vistas</th>
                                    <th>Pico Espectadores</th>
                                    <th>Pico Canales</th>
                                </tr>
                            </thead>
                            <tbody>`;

            games.forEach(game => {
                tableHTML += `
                    <tr>
                        <td>${game.id}</td>
                        <td>${game.game}</td>
                        <td>${game.date}</td>
                        <td>${game.hours_watched.toLocaleString()}</td>
                        <td>${game.peak_viewers.toLocaleString()}</td>
                        <td>${game.peak_channels.toLocaleString()}</td>
                    </tr>`;
            });

            tableHTML += `
                            </tbody>
                        </table>
                    </div>
                </div>`;

            // Insertar la tabla en el contenedor de formularios
            const formsContainer = document.querySelector('.forms-container');
            const existingList = document.getElementById('listForm');
            if (existingList) {
                existingList.remove();
            }
            formsContainer.insertAdjacentHTML('beforeend', tableHTML);

            // Mostrar la tabla
            document.getElementById('listForm').style.display = 'block';

        } else {
            alert('Error al cargar los juegos');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al cargar los juegos');
    }
}
</script>

<style>
.table-container {
    overflow-x: auto;
    margin-top: 1em;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 0.5em;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

th {
    background-color: rgba(0, 0, 0, 0.2);
}

tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}
</style>
<!-- Agrega esta función JavaScript al final del archivo, dentro de las etiquetas <script> existentes -->
<script>
async function showGamesList() {
    try {
        const response = await fetch('/api/games');
        if (response.ok) {
            const games = await response.json();
            hideAllForms();

            const tableHTML = `
                <div id="listForm" class="operation-form rpgui-container framed-golden">
                    <h3>📋 Lista de Juegos</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Fecha</th>
                                    <th>Horas Vistas</th>
                                    <th>Pico Espectadores</th>
                                    <th>Pico Canales</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${games.map(game => `
                                    <tr>
                                        <td>${game.id}</td>
                                        <td>${game.game}</td>
                                        <td>${game.date}</td>
                                        <td>${game.hours_watched.toLocaleString()}</td>
                                        <td>${game.peak_viewers.toLocaleString()}</td>
                                        <td>${game.peak_channels.toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            const formsContainer = document.querySelector('.forms-container');
            const existingList = document.getElementById('listForm');
            if (existingList) {
                existingList.remove();
            }
            formsContainer.insertAdjacentHTML('beforeend', tableHTML);
            document.getElementById('listForm').style.display = 'block';
        } else {
            alert('Error al cargar los juegos');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al cargar los juegos');
    }
}
</script>

<!-- Añade estos estilos específicos -->
<style>
.table-wrapper {
    max-height: 400px;  /* Altura máxima fija */
    overflow-y: auto;   /* Scroll vertical */
    margin: 1em 0;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.table-container {
    width: 100%;
}

.table-container table {
    width: 100%;
    border-collapse: collapse;
}

.table-container th {
    position: sticky;
    top: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1;
    padding: 10px;
    text-align: left;
}

.table-container td {
    padding: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.table-container tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

/* Estilo para la barra de desplazamiento */
.table-wrapper::-webkit-scrollbar {
    width: 12px;
}

.table-wrapper::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

.table-wrapper::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    border: 3px solid rgba(0, 0, 0, 0.3);
}

.table-wrapper::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.3);
}
</style>
{% endblock %}
<style>
/* Asegúrate de que estos estilos estén presentes y no sean sobrescritos */
.page-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1em;
    padding: 1em;
    height: calc(100vh - 100px);
    overflow: hidden;
}

.forms-container {
    height: 100%;
    overflow-y: auto;
    padding-right: 1em;
}

/* Nuevos estilos para la tabla */
.table-container {
    height: 100%;
    overflow: hidden;
}

#listForm {
    height: calc(100vh - 150px);
    display: flex;
    flex-direction: column;
}

.table-wrapper {
    flex: 1;
    overflow-y: auto;
    margin-top: 1em;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    position: sticky;
    top: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1;
}
</style>

<script>
async function showGamesList() {
    try {
        const response = await fetch('/api/games');
        if (response.ok) {
            const games = await response.json();
            hideAllForms();

            const tableHTML = `
                <div id="listForm" class="operation-form rpgui-container framed-golden">
                    <h3>📋 Lista de Juegos</h3>
                    <div class="table-wrapper rpgui-container framed">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Fecha</th>
                                    <th>Horas Vistas</th>
                                    <th>Pico Espectadores</th>
                                    <th>Pico Canales</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${games.map(game => `
                                    <tr>
                                        <td>${game.id}</td>
                                        <td>${game.game}</td>
                                        <td>${game.date}</td>
                                        <td>${game.hours_watched.toLocaleString()}</td>
                                        <td>${game.peak_viewers.toLocaleString()}</td>
                                        <td>${game.peak_channels.toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            const formsContainer = document.querySelector('.forms-container');
            const existingList = document.getElementById('listForm');
            if (existingList) {
                existingList.remove();
            }
            formsContainer.insertAdjacentHTML('beforeend', tableHTML);
            document.getElementById('listForm').style.display = 'block';
        } else {
            alert('Error al cargar los juegos');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al cargar los juegos');
    }
}
</script>
<style>
/* Ajustes para el layout principal */
.page-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1em;
    padding: 1em;
    height: calc(100vh - 170px); /* Ajustado para considerar navbar y footer */
    max-height: calc(100vh - 170px);
    overflow: hidden;
    margin: 0;
}

.forms-container {
    height: 100%;
    overflow-y: auto;
    padding-right: 1em;
    max-height: calc(100vh - 170px);
}

/* Estilos para el contenedor de la tabla */
#listForm {
    height: calc(100vh - 200px); /* Altura ajustada */
    max-height: calc(100vh - 200px);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    margin-bottom: 0;
}

.table-wrapper {
    flex: 1;
    overflow-y: auto;
    margin-top: 1em;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    height: calc(100% - 50px); /* Resta el espacio del título */
}

/* Estilos para la tabla */
table {
    width: 100%;
    border-collapse: collapse;
}

th {
    position: sticky;
    top: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1;
    padding: 0.5em;
}

td {
    padding: 0.5em;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

/* Estilos para el scroll */
.table-wrapper::-webkit-scrollbar {
    width: 12px;
}

.table-wrapper::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

.table-wrapper::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    border: 3px solid rgba(0, 0, 0, 0.3);
}
</style>
